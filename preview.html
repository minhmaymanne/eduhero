<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EduHero — Asset Preview</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #0F172A;
      color: #E2E8F0;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      padding: 24px;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 8px;
      color: #F8FAFC;
    }
    .subtitle {
      text-align: center;
      color: #94A3B8;
      font-size: 14px;
      margin-bottom: 32px;
    }
    h2 {
      font-size: 20px;
      color: #F8FAFC;
      margin: 32px 0 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid #1E293B;
    }
    h3 {
      font-size: 15px;
      color: #CBD5E1;
      margin: 20px 0 10px;
    }

    /* Hero grid */
    .hero-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(540px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    .hero-card {
      background: #1E293B;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #334155;
    }
    .hero-card-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
    }
    .hero-card-title .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }
    .hero-card-title span {
      font-size: 16px;
      font-weight: 600;
    }
    .hero-card-title .tag {
      font-size: 11px;
      background: #334155;
      padding: 2px 8px;
      border-radius: 4px;
      color: #94A3B8;
    }

    /* Animation row */
    .anim-row {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 6px;
    }
    .anim-label {
      width: 64px;
      font-size: 11px;
      color: #64748B;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      flex-shrink: 0;
    }
    .anim-frames {
      display: flex;
      gap: 2px;
    }
    .anim-frames canvas {
      background: #0F172A;
      border-radius: 4px;
      border: 1px solid #334155;
    }
    .anim-frames canvas.active-frame {
      border-color: #3B82F6;
      box-shadow: 0 0 6px rgba(59,130,246,0.3);
    }

    /* Live preview (animated) */
    .live-row {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid #334155;
    }
    .live-row canvas {
      background: #0F172A;
      border-radius: 6px;
      border: 1px solid #334155;
    }
    .live-info {
      font-size: 12px;
      color: #64748B;
    }
    .live-info .state-name {
      color: #E2E8F0;
      font-weight: 600;
      font-size: 13px;
    }

    /* Spritesheet display */
    .spritesheet-section {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      margin-bottom: 32px;
    }
    .spritesheet-card {
      background: #1E293B;
      border-radius: 12px;
      padding: 16px;
      border: 1px solid #334155;
      text-align: center;
    }
    .spritesheet-card canvas {
      border-radius: 4px;
      border: 1px solid #334155;
      background: #0F172A;
    }
    .spritesheet-card .label {
      font-size: 12px;
      color: #94A3B8;
      margin-top: 8px;
    }

    /* Projectile section */
    .proj-section {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 32px;
    }
    .proj-card {
      background: #1E293B;
      border-radius: 12px;
      padding: 16px 20px;
      border: 1px solid #334155;
      text-align: center;
      min-width: 160px;
    }
    .proj-card canvas {
      background: #0F172A;
      border-radius: 4px;
      border: 1px solid #334155;
      margin: 8px 2px;
    }
    .proj-card .label {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .proj-card .sublabel {
      font-size: 11px;
      color: #64748B;
    }

    /* Size comparison */
    .size-compare {
      display: flex;
      align-items: flex-end;
      gap: 24px;
      margin-top: 16px;
    }
    .size-box {
      text-align: center;
    }
    .size-box canvas {
      background: #0F172A;
      border-radius: 4px;
      border: 1px solid #334155;
    }
    .size-box .dim {
      font-size: 11px;
      color: #64748B;
      margin-top: 4px;
    }

    /* Controls */
    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 24px;
      padding: 12px 16px;
      background: #1E293B;
      border-radius: 8px;
      border: 1px solid #334155;
    }
    .controls label {
      font-size: 13px;
      color: #94A3B8;
    }
    .controls select, .controls button {
      background: #334155;
      border: 1px solid #475569;
      color: #E2E8F0;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
    }
    .controls button:hover {
      background: #475569;
    }
    .controls button.active {
      background: #3B82F6;
      border-color: #3B82F6;
    }
    .palette-strip {
      display: flex;
      gap: 3px;
      margin-left: auto;
    }
    .palette-strip .swatch {
      width: 18px;
      height: 18px;
      border-radius: 3px;
      border: 1px solid rgba(255,255,255,0.15);
    }

    .footer {
      text-align: center;
      color: #475569;
      font-size: 12px;
      margin-top: 40px;
      padding-top: 16px;
      border-top: 1px solid #1E293B;
    }
  </style>
</head>
<body>
  <h1>EduHero Asset Preview</h1>
  <p class="subtitle">Cartoon Chibi &middot; Smooth Vector 2D &middot; Canvas 128&times;128 render &rarr; 64&times;64 display</p>

  <div class="controls">
    <label>Animation:</label>
    <select id="animSelect">
      <option value="idle">IDLE</option>
      <option value="walk">WALK</option>
      <option value="attack">ATTACK</option>
      <option value="hurt">HURT</option>
      <option value="death">DEATH</option>
      <option value="special">SPECIAL</option>
    </select>
    <button id="btnPlay" class="active">Play</button>
    <button id="btnPause">Pause</button>
    <label style="margin-left:12px">Speed:</label>
    <select id="speedSelect">
      <option value="200">Slow</option>
      <option value="120" selected>Normal</option>
      <option value="60">Fast</option>
    </select>
  </div>

  <h2>Heroes — All Animation States</h2>
  <div class="hero-section" id="heroSection"></div>

  <h2>Heroes — Live Animation</h2>
  <div class="hero-section" id="liveSection"></div>

  <h2>Heroes — Full Spritesheets (512&times;768)</h2>
  <div class="spritesheet-section" id="spritesheetSection"></div>

  <h2>Projectiles</h2>
  <div class="proj-section" id="projSection"></div>

  <h2>Size Comparison (render vs display)</h2>
  <div class="size-compare" id="sizeCompare"></div>

  <div class="footer">
    EduHero &mdash; Asset Preview &middot; Open this file in any browser to view
  </div>

  <!-- Load asset scripts in order -->
  <script src="src/assets/heroes/hero-base.js"></script>
  <script>
    // Bridge: expose hero-base functions as window.HeroBase
    window.HeroBase = {
      roundRect: roundRect,
      drawShadow: drawShadow,
      drawLegs: drawLegs,
      drawBody: drawBody,
      drawArms: drawArms,
      drawHead: drawHead,
      drawFace: drawFace,
      applyAnimTransform: applyAnimTransform,
      getDeathAlpha: getDeathAlpha
    };
  </script>

  <script src="src/assets/heroes/hero-frost-knight.js"></script>
  <script>
    window.HeroFrostKnight = {
      FROST_PALETTE: FROST_PALETTE,
      drawFrostKnight: drawFrostKnight
    };
  </script>

  <script src="src/assets/heroes/hero-fire-knight.js"></script>
  <script>
    window.HeroFireKnight = {
      FIRE_PALETTE: FIRE_PALETTE,
      drawFireKnight: drawFireKnight
    };
  </script>

  <script src="src/assets/heroes/hero-nature-knight.js"></script>
  <script>
    window.HeroNatureKnight = {
      NATURE_PALETTE: NATURE_PALETTE,
      drawNatureKnight: drawNatureKnight
    };
  </script>

  <script src="src/assets/heroes/hero-shadow-knight.js"></script>
  <script>
    window.HeroShadowKnight = {
      SHADOW_PALETTE: SHADOW_PALETTE,
      drawShadowKnight: drawShadowKnight
    };
  </script>

  <script src="src/assets/projectiles/projectile-ice-shard.js"></script>
  <script src="src/assets/projectiles/projectile-fireball.js"></script>
  <script src="src/assets/projectiles/projectile-leaf-blade.js"></script>
  <script src="src/assets/projectiles/projectile-dark-orb.js"></script>

  <script>
    // =========================================================================
    // Config
    // =========================================================================
    var FRAME_SIZE = 128;
    var DISPLAY_SIZE = 64;
    var PROJ_SIZE = 32;
    var PROJ_DISPLAY = 64; // scaled up for visibility

    var ANIM_DEFS = [
      { name: 'idle',    frames: 4, fps: 4 },
      { name: 'walk',    frames: 4, fps: 8 },
      { name: 'attack',  frames: 3, fps: 10 },
      { name: 'hurt',    frames: 2, fps: 8 },
      { name: 'death',   frames: 3, fps: 6 },
      { name: 'special', frames: 4, fps: 8 }
    ];

    var HEROES = [
      {
        name: 'Frost Knight',
        element: 'Ice / Sword',
        color: '#4F46E5',
        palette: FROST_PALETTE,
        draw: drawFrostKnight
      },
      {
        name: 'Fire Knight',
        element: 'Fire / Sword',
        color: '#EF4444',
        palette: FIRE_PALETTE,
        draw: drawFireKnight
      },
      {
        name: 'Nature Knight',
        element: 'Nature / Staff',
        color: '#22C55E',
        palette: NATURE_PALETTE,
        draw: drawNatureKnight
      },
      {
        name: 'Shadow Knight',
        element: 'Dark / Daggers',
        color: '#6D28D9',
        palette: SHADOW_PALETTE,
        draw: drawShadowKnight
      }
    ];

    var PROJECTILES = [
      { name: 'Ice Shard',  hero: 'Frost', draw: drawIceShard,  palette: ICE_SHARD_PALETTE,  color: '#93C5FD' },
      { name: 'Fireball',   hero: 'Fire',  draw: drawFireball,  palette: FIREBALL_PALETTE,   color: '#F59E0B' },
      { name: 'Leaf Blade', hero: 'Nature',draw: drawLeafBlade, palette: LEAF_BLADE_PALETTE, color: '#4ADE80' },
      { name: 'Dark Orb',   hero: 'Shadow',draw: drawDarkOrb,   palette: DARK_ORB_PALETTE,   color: '#7C3AED' }
    ];

    // =========================================================================
    // Render hero animation grid (all frames for all states)
    // =========================================================================
    var heroSection = document.getElementById('heroSection');

    HEROES.forEach(function(hero) {
      var card = document.createElement('div');
      card.className = 'hero-card';

      // Title
      var title = document.createElement('div');
      title.className = 'hero-card-title';
      title.innerHTML = '<span class="dot" style="background:' + hero.color + '"></span>' +
        '<span>' + hero.name + '</span>' +
        '<span class="tag">' + hero.element + '</span>';
      card.appendChild(title);

      // Palette strip
      var strip = document.createElement('div');
      strip.className = 'palette-strip';
      strip.style.marginBottom = '12px';
      var paletteColors = [hero.palette.primary, hero.palette.primaryShadow,
        hero.palette.primaryHighlight, hero.palette.secondary, hero.palette.skin, hero.palette.outline];
      paletteColors.forEach(function(c) {
        var sw = document.createElement('div');
        sw.className = 'swatch';
        sw.style.background = c;
        sw.title = c;
        strip.appendChild(sw);
      });
      card.appendChild(strip);

      // Each animation state
      ANIM_DEFS.forEach(function(anim) {
        var row = document.createElement('div');
        row.className = 'anim-row';

        var label = document.createElement('div');
        label.className = 'anim-label';
        label.textContent = anim.name;
        row.appendChild(label);

        var framesDiv = document.createElement('div');
        framesDiv.className = 'anim-frames';

        for (var f = 0; f < anim.frames; f++) {
          var canvas = document.createElement('canvas');
          canvas.width = FRAME_SIZE;
          canvas.height = FRAME_SIZE;
          canvas.style.width = DISPLAY_SIZE + 'px';
          canvas.style.height = DISPLAY_SIZE + 'px';
          canvas.dataset.hero = hero.name;
          canvas.dataset.anim = anim.name;
          canvas.dataset.frame = f;

          var ctx = canvas.getContext('2d');
          hero.draw(ctx, FRAME_SIZE, hero.palette, f, anim.name);

          framesDiv.appendChild(canvas);
        }
        row.appendChild(framesDiv);
        card.appendChild(row);
      });

      heroSection.appendChild(card);
    });

    // =========================================================================
    // Live animated preview
    // =========================================================================
    var liveSection = document.getElementById('liveSection');
    var liveCanvases = [];

    HEROES.forEach(function(hero) {
      var card = document.createElement('div');
      card.className = 'hero-card';

      var title = document.createElement('div');
      title.className = 'hero-card-title';
      title.innerHTML = '<span class="dot" style="background:' + hero.color + '"></span>' +
        '<span>' + hero.name + '</span>';
      card.appendChild(title);

      var liveRow = document.createElement('div');
      liveRow.style.display = 'flex';
      liveRow.style.alignItems = 'center';
      liveRow.style.gap = '16px';

      // Large preview canvas
      var canvas = document.createElement('canvas');
      canvas.width = FRAME_SIZE;
      canvas.height = FRAME_SIZE;
      canvas.style.width = (FRAME_SIZE) + 'px';
      canvas.style.height = (FRAME_SIZE) + 'px';
      canvas.style.borderRadius = '8px';
      canvas.style.background = '#0F172A';
      canvas.style.border = '1px solid #334155';
      liveRow.appendChild(canvas);

      // Small preview (display size)
      var canvasSmall = document.createElement('canvas');
      canvasSmall.width = FRAME_SIZE;
      canvasSmall.height = FRAME_SIZE;
      canvasSmall.style.width = DISPLAY_SIZE + 'px';
      canvasSmall.style.height = DISPLAY_SIZE + 'px';
      canvasSmall.style.borderRadius = '6px';
      canvasSmall.style.background = '#0F172A';
      canvasSmall.style.border = '1px solid #334155';
      liveRow.appendChild(canvasSmall);

      var info = document.createElement('div');
      info.className = 'live-info';
      info.innerHTML = '<div class="state-name" id="state_' + hero.name.replace(/\s/g, '') + '">IDLE</div>' +
        '<div>128&times;128 render &rarr; 64&times;64 display</div>' +
        '<div style="margin-top:4px;color:#64748B;">Frame: <span id="frame_' + hero.name.replace(/\s/g, '') + '">0</span></div>';
      liveRow.appendChild(info);

      card.appendChild(liveRow);
      liveSection.appendChild(card);

      liveCanvases.push({
        hero: hero,
        canvas: canvas,
        canvasSmall: canvasSmall,
        stateEl: document.getElementById('state_' + hero.name.replace(/\s/g, '')),
        frameEl: document.getElementById('frame_' + hero.name.replace(/\s/g, ''))
      });
    });

    // =========================================================================
    // Full spritesheets
    // =========================================================================
    var ssSection = document.getElementById('spritesheetSection');

    HEROES.forEach(function(hero) {
      var card = document.createElement('div');
      card.className = 'spritesheet-card';

      var canvas = document.createElement('canvas');
      canvas.width = FRAME_SIZE * 4;   // 512
      canvas.height = FRAME_SIZE * 6;  // 768
      canvas.style.width = (FRAME_SIZE * 4 / 2) + 'px';  // show at 50%
      canvas.style.height = (FRAME_SIZE * 6 / 2) + 'px';
      var ctx = canvas.getContext('2d');

      ANIM_DEFS.forEach(function(anim, row) {
        for (var col = 0; col < anim.frames; col++) {
          ctx.save();
          ctx.translate(col * FRAME_SIZE, row * FRAME_SIZE);
          hero.draw(ctx, FRAME_SIZE, hero.palette, col, anim.name);
          ctx.restore();
        }
      });

      card.appendChild(canvas);
      var label = document.createElement('div');
      label.className = 'label';
      label.innerHTML = '<strong style="color:' + hero.color + '">' + hero.name + '</strong><br>512&times;768 &middot; 6 rows &times; 4 cols';
      card.appendChild(label);
      ssSection.appendChild(card);
    });

    // =========================================================================
    // Projectiles
    // =========================================================================
    var projSection = document.getElementById('projSection');

    PROJECTILES.forEach(function(proj) {
      var card = document.createElement('div');
      card.className = 'proj-card';

      var label = document.createElement('div');
      label.className = 'label';
      label.style.color = proj.color;
      label.textContent = proj.name;
      card.appendChild(label);

      var sublabel = document.createElement('div');
      sublabel.className = 'sublabel';
      sublabel.textContent = proj.hero + ' Knight';
      card.appendChild(sublabel);

      // 3 frames at scaled size
      var framesDiv = document.createElement('div');
      framesDiv.style.display = 'flex';
      framesDiv.style.gap = '4px';
      framesDiv.style.justifyContent = 'center';
      framesDiv.style.marginTop = '8px';

      for (var f = 0; f < 3; f++) {
        var canvas = document.createElement('canvas');
        canvas.width = PROJ_SIZE;
        canvas.height = PROJ_SIZE;
        canvas.style.width = PROJ_DISPLAY + 'px';
        canvas.style.height = PROJ_DISPLAY + 'px';
        canvas.style.imageRendering = 'auto';
        var ctx = canvas.getContext('2d');
        proj.draw(ctx, PROJ_SIZE, proj.palette, f);
        framesDiv.appendChild(canvas);
      }
      card.appendChild(framesDiv);

      // Animated live
      var liveCanvas = document.createElement('canvas');
      liveCanvas.width = PROJ_SIZE;
      liveCanvas.height = PROJ_SIZE;
      liveCanvas.style.width = (PROJ_DISPLAY * 1.5) + 'px';
      liveCanvas.style.height = (PROJ_DISPLAY * 1.5) + 'px';
      liveCanvas.style.marginTop = '8px';
      liveCanvas.style.imageRendering = 'auto';
      card.appendChild(liveCanvas);
      card._liveCanvas = liveCanvas;
      card._proj = proj;

      var dimLabel = document.createElement('div');
      dimLabel.className = 'sublabel';
      dimLabel.style.marginTop = '6px';
      dimLabel.textContent = '32\u00d732 canvas \u2192 16-20px display';
      card.appendChild(dimLabel);

      projSection.appendChild(card);
    });

    // =========================================================================
    // Size comparison
    // =========================================================================
    var sizeCompare = document.getElementById('sizeCompare');

    // 128x128 (render)
    var box1 = document.createElement('div');
    box1.className = 'size-box';
    var c1 = document.createElement('canvas');
    c1.width = FRAME_SIZE; c1.height = FRAME_SIZE;
    c1.style.width = FRAME_SIZE + 'px'; c1.style.height = FRAME_SIZE + 'px';
    drawFrostKnight(c1.getContext('2d'), FRAME_SIZE, FROST_PALETTE, 0, 'idle');
    box1.appendChild(c1);
    var d1 = document.createElement('div');
    d1.className = 'dim';
    d1.textContent = '128\u00d7128 (render size)';
    box1.appendChild(d1);
    sizeCompare.appendChild(box1);

    // 64x64 (display)
    var box2 = document.createElement('div');
    box2.className = 'size-box';
    var c2 = document.createElement('canvas');
    c2.width = FRAME_SIZE; c2.height = FRAME_SIZE;
    c2.style.width = DISPLAY_SIZE + 'px'; c2.style.height = DISPLAY_SIZE + 'px';
    drawFrostKnight(c2.getContext('2d'), FRAME_SIZE, FROST_PALETTE, 0, 'idle');
    box2.appendChild(c2);
    var d2 = document.createElement('div');
    d2.className = 'dim';
    d2.textContent = '64\u00d764 (display size)';
    box2.appendChild(d2);
    sizeCompare.appendChild(box2);

    // 48px (minimum readable)
    var box3 = document.createElement('div');
    box3.className = 'size-box';
    var c3 = document.createElement('canvas');
    c3.width = FRAME_SIZE; c3.height = FRAME_SIZE;
    c3.style.width = '48px'; c3.style.height = '48px';
    drawFrostKnight(c3.getContext('2d'), FRAME_SIZE, FROST_PALETTE, 0, 'idle');
    box3.appendChild(c3);
    var d3 = document.createElement('div');
    d3.className = 'dim';
    d3.textContent = '48px (min readable)';
    box3.appendChild(d3);
    sizeCompare.appendChild(box3);

    // Projectile sizes
    var box4 = document.createElement('div');
    box4.className = 'size-box';
    var c4 = document.createElement('canvas');
    c4.width = PROJ_SIZE; c4.height = PROJ_SIZE;
    c4.style.width = PROJ_SIZE + 'px'; c4.style.height = PROJ_SIZE + 'px';
    drawIceShard(c4.getContext('2d'), PROJ_SIZE, ICE_SHARD_PALETTE, 0);
    box4.appendChild(c4);
    var d4 = document.createElement('div');
    d4.className = 'dim';
    d4.textContent = '32\u00d732 projectile (render)';
    box4.appendChild(d4);
    sizeCompare.appendChild(box4);

    var box5 = document.createElement('div');
    box5.className = 'size-box';
    var c5 = document.createElement('canvas');
    c5.width = PROJ_SIZE; c5.height = PROJ_SIZE;
    c5.style.width = '20px'; c5.style.height = '20px';
    drawIceShard(c5.getContext('2d'), PROJ_SIZE, ICE_SHARD_PALETTE, 0);
    box5.appendChild(c5);
    var d5 = document.createElement('div');
    d5.className = 'dim';
    d5.textContent = '20px projectile (display)';
    box5.appendChild(d5);
    sizeCompare.appendChild(box5);

    // =========================================================================
    // Animation loop
    // =========================================================================
    var currentAnim = 'idle';
    var currentFrame = 0;
    var playing = true;
    var speed = 120;
    var lastTick = 0;

    var animSelect = document.getElementById('animSelect');
    var speedSelect = document.getElementById('speedSelect');
    var btnPlay = document.getElementById('btnPlay');
    var btnPause = document.getElementById('btnPause');

    animSelect.addEventListener('change', function() {
      currentAnim = this.value;
      currentFrame = 0;
    });
    speedSelect.addEventListener('change', function() {
      speed = parseInt(this.value);
    });
    btnPlay.addEventListener('click', function() {
      playing = true;
      btnPlay.classList.add('active');
      btnPause.classList.remove('active');
    });
    btnPause.addEventListener('click', function() {
      playing = false;
      btnPause.classList.add('active');
      btnPlay.classList.remove('active');
    });

    function getAnimDef(name) {
      for (var i = 0; i < ANIM_DEFS.length; i++) {
        if (ANIM_DEFS[i].name === name) return ANIM_DEFS[i];
      }
      return ANIM_DEFS[0];
    }

    function tick(now) {
      if (playing && now - lastTick >= speed) {
        lastTick = now;
        var animDef = getAnimDef(currentAnim);
        currentFrame = (currentFrame + 1) % animDef.frames;

        // Update live hero canvases
        liveCanvases.forEach(function(item) {
          // Large
          var ctx = item.canvas.getContext('2d');
          ctx.clearRect(0, 0, FRAME_SIZE, FRAME_SIZE);
          item.hero.draw(ctx, FRAME_SIZE, item.hero.palette, currentFrame, currentAnim);

          // Small
          var ctxS = item.canvasSmall.getContext('2d');
          ctxS.clearRect(0, 0, FRAME_SIZE, FRAME_SIZE);
          item.hero.draw(ctxS, FRAME_SIZE, item.hero.palette, currentFrame, currentAnim);

          // Labels
          item.stateEl.textContent = currentAnim.toUpperCase();
          item.frameEl.textContent = currentFrame;
        });

        // Update live projectile canvases
        var projCards = projSection.querySelectorAll('.proj-card');
        projCards.forEach(function(card) {
          if (card._liveCanvas && card._proj) {
            var ctx = card._liveCanvas.getContext('2d');
            ctx.clearRect(0, 0, PROJ_SIZE, PROJ_SIZE);
            card._proj.draw(ctx, PROJ_SIZE, card._proj.palette, currentFrame % 3);
          }
        });

        // Highlight active frame in static grid
        var allFrameCanvases = heroSection.querySelectorAll('.anim-frames canvas');
        allFrameCanvases.forEach(function(c) {
          if (c.dataset.anim === currentAnim && parseInt(c.dataset.frame) === currentFrame) {
            c.classList.add('active-frame');
          } else {
            c.classList.remove('active-frame');
          }
        });
      }
      requestAnimationFrame(tick);
    }

    requestAnimationFrame(tick);
  </script>
</body>
</html>
